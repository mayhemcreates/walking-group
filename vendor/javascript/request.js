import e from"http";import t from"url";import o from"util";import r from"stream";import n from"querystring";import s from"crypto";import a from"net";import p from"tls";import c from"https";import u from"events";import l from"assert";import h from"process";import f from"buffer";var m={};m.types={"3gp":"video/3gpp",aiff:"audio/x-aiff",arj:"application/x-arj-compressed",asf:"video/x-ms-asf",asx:"video/x-ms-asx",au:"audio/ulaw",avi:"video/x-msvideo",bcpio:"application/x-bcpio",ccad:"application/clariscad",cod:"application/vnd.rim.cod",com:"application/x-msdos-program",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",deb:"application/x-debian-package",dl:"video/dl",doc:"application/msword",drw:"application/drafting",dvi:"application/x-dvi",dwg:"application/acad",dxf:"application/dxf",dxr:"application/x-director",etx:"text/x-setext",ez:"application/andrew-inset",fli:"video/x-fli",flv:"video/x-flv",gif:"image/gif",gl:"video/gl",gtar:"application/x-gtar",gz:"application/x-gzip",hdf:"application/x-hdf",hqx:"application/mac-binhex40",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ief:"image/ief",igs:"model/iges",ips:"application/x-ipscript",ipx:"application/x-ipix",jad:"text/vnd.sun.j2me.app-descriptor",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",latex:"application/x-latex",lsp:"application/x-lisp",lzh:"application/octet-stream",m:"text/plain",m3u:"audio/x-mpegurl",m4v:"video/mp4",man:"application/x-troff-man",me:"application/x-troff-me",midi:"audio/midi",mif:"application/x-mif",mime:"www/mime",mkv:"  video/x-matrosk",movie:"video/x-sgi-movie",mp4:"video/mp4",mp41:"video/mp4",mp42:"video/mp4",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",mustache:"text/plain",nc:"application/x-netcdf",oda:"application/oda",ogm:"application/ogg",pbm:"image/x-portable-bitmap",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pgp:"application/pgp",pm:"application/x-perl",png:"image/png",pnm:"image/x-portable-anymap",ppm:"image/x-portable-pixmap",ppz:"application/vnd.ms-powerpoint",pre:"application/x-freelance",prt:"application/pro_eng",ps:"application/postscript",qt:"video/quicktime",ra:"audio/x-realaudio",rar:"application/x-rar-compressed",ras:"image/x-cmu-raster",rgb:"image/x-rgb",rm:"audio/x-pn-realaudio",rpm:"audio/x-pn-realaudio-plugin",rtf:"text/rtf",rtx:"text/richtext",scm:"application/x-lotusscreencam",set:"application/set",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skt:"application/x-koan",smil:"application/smil",snd:"audio/basic",sol:"application/solids",spl:"application/x-futuresplash",src:"application/x-wais-source",stl:"application/SLA",stp:"application/STEP",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texinfo:"application/x-texinfo",tgz:"application/x-tar-gz",tiff:"image/tiff",tr:"application/x-troff",tsi:"audio/TSP-audio",tsp:"application/dsptype",tsv:"text/tab-separated-values",unv:"application/i-deas",ustar:"application/x-ustar",vcd:"application/x-cdlink",vda:"application/vda",vivo:"video/vnd.vivo",vrm:"x-world/x-vrml",wav:"audio/x-wav",wax:"audio/x-ms-wax",webm:"video/webm",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wrl:"model/vrml",wvx:"video/x-ms-wvx",xbm:"image/x-xbitmap",xlw:"application/vnd.ms-excel",xml:"text/xml",xpm:"image/x-xpixmap",xwd:"image/x-xwindowdump",xyz:"chemical/x-pdb",zip:"application/zip"};m.lookup=function(e,t){t=t||"application/octet-stream";return e in m.types?m.types[e]:t};var g={};var v=s,y=n;function sha1(e,t){return v.createHmac("sha1",e).update(t).digest("base64")}function rfc3986(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/'/g,"%27")}function hmacsign(e,t,o,r,i,n){var s=(e||"GET")+"&"+encodeURIComponent(t)+"&"+Object.keys(o).sort().map((function(e){return escape(rfc3986(e))+"%3D"+escape(rfc3986(o[e]))})).join("%26");var a=r+"&";i&&(a+=i);return sha1(a,s)}g.hmacsign=hmacsign;g.rfc3986=rfc3986;var x={};x=function(){var e=[],t="0123456789ABCDEF";for(var o=0;o<36;o++)e[o]=Math.floor(16*Math.random());e[14]=4;e[19]=3&e[19]|8;for(var o=0;o<36;o++)e[o]=t[e[o]];e[8]=e[13]=e[18]=e[23]="-";return e.join("")};var b=x;var k="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var q={};q=ForeverAgent;ForeverAgent.SSL=ForeverAgentSSL;var S=o,w=e.Agent,E=a,A=p,O=c.Agent;function ForeverAgent(e){var t=this||k;t.options=e||{};t.requests={};t.sockets={};t.freeSockets={};t.maxSockets=t.options.maxSockets||w.defaultMaxSockets;t.minSockets=t.options.minSockets||ForeverAgent.defaultMinSockets;t.on("free",(function(e,o,r){var i=o+":"+r;if(t.requests[i]&&t.requests[i].length)t.requests[i].shift().onSocket(e);else if(t.sockets[i].length<t.minSockets){t.freeSockets[i]||(t.freeSockets[i]=[]);t.freeSockets[i].push(e);function onIdleError(){e.destroy()}e._onIdleError=onIdleError;e.on("error",onIdleError)}else e.destroy()}))}S.inherits(ForeverAgent,w);ForeverAgent.defaultMinSockets=5;ForeverAgent.prototype.createConnection=E.createConnection;ForeverAgent.prototype.addRequestNoreuse=w.prototype.addRequest;ForeverAgent.prototype.addRequest=function(e,t,o){var r=t+":"+o;if((this||k).freeSockets[r]&&(this||k).freeSockets[r].length>0&&!e.useChunkedEncodingByDefault){var i=(this||k).freeSockets[r].pop();i.removeListener("error",i._onIdleError);delete i._onIdleError;e._reusedSocket=true;e.onSocket(i)}else this.addRequestNoreuse(e,t,o)};ForeverAgent.prototype.removeSocket=function(e,t,o,r){if((this||k).sockets[t]){var i=(this||k).sockets[t].indexOf(e);-1!==i&&(this||k).sockets[t].splice(i,1)}else if((this||k).sockets[t]&&0===(this||k).sockets[t].length){delete(this||k).sockets[t];delete(this||k).requests[t]}if((this||k).freeSockets[t]){var i=(this||k).freeSockets[t].indexOf(e);if(-1!==i){(this||k).freeSockets[t].splice(i,1);0===(this||k).freeSockets[t].length&&delete(this||k).freeSockets[t]}}(this||k).requests[t]&&(this||k).requests[t].length&&this.createSocket(t,o,r).emit("free")};function ForeverAgentSSL(e){ForeverAgent.call(this||k,e)}S.inherits(ForeverAgentSSL,ForeverAgent);ForeverAgentSSL.prototype.createConnection=createConnectionSSL;ForeverAgentSSL.prototype.addRequestNoreuse=O.prototype.addRequest;function createConnectionSSL(e,t,o){o.port=e;o.host=t;return A.connect(o)}var R=q;var T="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var _={};var j=t;var C=_=_=function Cookie(e,t){(this||T).str=e;e.split(/ *; */).reduce((function(e,t){var o=t.indexOf("=");var r=o>0?t.substring(0,o).trim():t.trim();var i=r.toLowerCase();var n=!(o>0)||t.substring(o+1).trim();if(e.name)"httponly"===i?e.httpOnly=n:e[i]=n;else{e.name=r;e.value=n}return e}),this||T);(this||T).expires=(this||T).expires?new Date((this||T).expires):Infinity;(this||T).path=(this||T).path?(this||T).path.trim():t?j.parse(t.url).pathname:"/"};C.prototype.toString=function(){return(this||T).str};var H=_;var N="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var F={};var M=t;var L=F=F=function CookieJar(){(this||N).cookies=[]};L.prototype.add=function(e){(this||N).cookies=(this||N).cookies.filter((function(t){return!(t.name==e.name&&t.path==e.path)}));(this||N).cookies.push(e)};L.prototype.get=function(e){var t=M.parse(e.url).pathname,o=new Date,r={};return(this||N).cookies.filter((function(e){if(0==t.indexOf(e.path)&&o<e.expires&&e.path.length>(r[e.name]||0))return r[e.name]=e.path.length}))};L.prototype.cookieString=function(e){var t=this.get(e);if(t.length)return t.map((function(e){return e.name+"="+e.value})).join("; ")};var D=F;var B={};var P=f.Buffer;var z=h;var I=a;var U=p;var J=e;var G=c;var Y=u;var K=l;var Q=o;B.httpOverHttp=httpOverHttp;B.httpsOverHttp=httpsOverHttp;B.httpOverHttps=httpOverHttps;B.httpsOverHttps=httpsOverHttps;function httpOverHttp(e){var t=new TunnelingAgent(e);t.request=J.request;return t}function httpsOverHttp(e){var t=new TunnelingAgent(e);t.request=J.request;t.createSocket=createSecureSocket;return t}function httpOverHttps(e){var t=new TunnelingAgent(e);t.request=G.request;return t}function httpsOverHttps(e){var t=new TunnelingAgent(e);t.request=G.request;t.createSocket=createSecureSocket;return t}function TunnelingAgent(e){var t=this;t.options=e||{};t.proxyOptions=t.options.proxy||{};t.maxSockets=t.options.maxSockets||J.Agent.defaultMaxSockets;t.requests=[];t.sockets=[];t.on("free",(function onFree(e,o,r){for(var i=0,n=t.requests.length;i<n;++i){var s=t.requests[i];if(s.host===o&&s.port===r){t.requests.splice(i,1);s.request.onSocket(e);return}}e.destroy();t.removeSocket(e)}))}Q.inherits(TunnelingAgent,Y.EventEmitter);TunnelingAgent.prototype.addRequest=function addRequest(e,t,o){var r=this;r.sockets.length>=this.maxSockets?r.requests.push({host:t,port:o,request:e}):r.createSocket({host:t,port:o,request:e},(function(i){i.on("free",onFree);i.on("close",onCloseOrRemove);i.on("agentRemove",onCloseOrRemove);e.onSocket(i);function onFree(){r.emit("free",i,t,o)}function onCloseOrRemove(e){r.removeSocket();i.removeListener("free",onFree);i.removeListener("close",onCloseOrRemove);i.removeListener("agentRemove",onCloseOrRemove)}}))};TunnelingAgent.prototype.createSocket=function createSocket(e,t){var o=this;var r={};o.sockets.push(r);var i=mergeOptions({},o.proxyOptions,{method:"CONNECT",path:e.host+":"+e.port,agent:false});if(i.proxyAuth){i.headers=i.headers||{};i.headers["Proxy-Authorization"]="Basic "+new P(i.proxyAuth).toString("base64")}V("making CONNECT request");var n=o.request(i);n.useChunkedEncodingByDefault=false;n.once("response",onResponse);n.once("upgrade",onUpgrade);n.once("connect",onConnect);n.once("error",onError);n.end();function onResponse(e){e.upgrade=true}function onUpgrade(e,t,o){z.nextTick((function(){onConnect(e,t,o)}))}function onConnect(i,s,a){n.removeAllListeners();s.removeAllListeners();if(200===i.statusCode){K.equal(a.length,0);V("tunneling connection has established");o.sockets[o.sockets.indexOf(r)]=s;t(s)}else{V("tunneling socket could not be established, statusCode=%d",i.statusCode);var p=new Error("tunneling socket could not be established, "+"sutatusCode="+i.statusCode);p.code="ECONNRESET";e.request.emit("error",p);o.removeSocket(r)}}function onError(t){n.removeAllListeners();V("tunneling socket could not be established, cause=%s\n",t.message,t.stack);var i=new Error("tunneling socket could not be established, "+"cause="+t.message);i.code="ECONNRESET";e.request.emit("error",i);o.removeSocket(r)}};TunnelingAgent.prototype.removeSocket=function removeSocket(e){var t=this.sockets.indexOf(e);if(-1!==t){this.sockets.splice(t,1);var o=this.requests.shift();o&&this.createSocket(o,(function(e){o.request.onSocket(e)}))}};function createSecureSocket(e,t){var o=this;TunnelingAgent.prototype.createSocket.call(o,e,(function(e){var r=U.connect(0,mergeOptions({},o.options,{socket:e}));t(r)}))}function mergeOptions(e){for(var t=1,o=arguments.length;t<o;++t){var r=arguments[t];if("object"===typeof r){var i=Object.keys(r);for(var n=0,s=i.length;n<s;++n){var a=i[n];void 0!==r[a]&&(e[a]=r[a])}}}return e}var V;V=z.env.NODE_DEBUG&&/\btunnel\b/.test(z.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments);"string"===typeof e[0]?e[0]="TUNNEL: "+e[0]:e.unshift("TUNNEL:");console.error.apply(console,e)}:function(){};B.debug=V;var W="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var X={};var Z=f.Buffer;var $=h;var ee=e,te=false,oe=false,re=t,ie=o,ne=r,se=n,ae=m,pe=g,ce=b,ue=R,le=H,he=D,de=new he,fe=B;if($.logging)var me=$.logging("request");try{te=c}catch(e){}try{oe=p}catch(e){}function toBase64(e){return new Z(e||"","ascii").toString("base64")}if(te&&!te.Agent){te.Agent=function(e){ee.Agent.call(this||W,e)};ie.inherits(te.Agent,ee.Agent);te.Agent.prototype._getConnection=function(e,t,o){var r=oe.connect(t,e,(this||W).options,(function(){o&&o()}));return r}}function isReadStream(e){if(e.readable&&e.path&&e.mode)return true}function copy(e){var t={};Object.keys(e).forEach((function(o){t[o]=e[o]}));return t}var ge=/^https?:/;var ve={};function Request(e){ne.Stream.call(this||W);(this||W).readable=true;(this||W).writable=true;"string"===typeof e&&(e={uri:e});var t=Object.keys(Request.prototype);for(var o in e)-1===t.indexOf(o)?(this||W)[o]=e[o]:"function"===typeof e[o]&&delete e[o];e=copy(e);this.init(e)}ie.inherits(Request,ne.Stream);Request.prototype.init=function(e){var t=this||W;e||(e={});t.pool||(t.pool=ve);t.dests=[];t.__isRequestRequest=true;if(!t._callback&&t.callback){t._callback=t.callback;t.callback=function(){if(!t._callbackCalled){t._callback.apply(t,arguments);t._callbackCalled=true}};t.on("error",t.callback.bind());t.on("complete",t.callback.bind(t,null))}if(t.url){t.uri=t.url;delete t.url}if(!t.uri)throw new Error("options.uri is a required argument");"string"==typeof t.uri&&(t.uri=re.parse(t.uri));if(t.proxy){"string"==typeof t.proxy&&(t.proxy=re.parse(t.proxy));if(ee.globalAgent&&"https:"===t.uri.protocol){t.tunnel=true;var o="http:"===t.proxy.protocol?fe.httpsOverHttp:fe.httpsOverHttps;var r={proxy:{host:t.proxy.hostname,port:+t.proxy.port,proxyAuth:t.proxy.auth},ca:(this||W).ca};t.agent=o(r);t.tunnel=true}}t._redirectsFollowed=t._redirectsFollowed||0;t.maxRedirects=void 0!==t.maxRedirects?t.maxRedirects:10;t.followRedirect=void 0===t.followRedirect||t.followRedirect;t.followAllRedirects=void 0!==t.followAllRedirects&&t.followAllRedirects;(t.followRedirect||t.followAllRedirects)&&(t.redirects=t.redirects||[]);t.headers=t.headers?copy(t.headers):{};t.setHost=false;if(!t.headers.host){t.headers.host=t.uri.hostname;t.uri.port&&(80===t.uri.port&&"http:"===t.uri.protocol||443===t.uri.port&&"https:"===t.uri.protocol||(t.headers.host+=":"+t.uri.port));t.setHost=true}t.jar(t._jar||e.jar);t.uri.pathname||(t.uri.pathname="/");t.uri.port||("http:"==t.uri.protocol?t.uri.port=80:"https:"==t.uri.protocol&&(t.uri.port=443));if(t.proxy&&!t.tunnel){t.port=t.proxy.port;t.host=t.proxy.hostname}else{t.port=t.uri.port;t.host=t.uri.hostname}t.clientErrorHandler=function(e){if(!t._aborted){t.setHost&&delete t.headers.host;if(t.req._reusedSocket&&"ECONNRESET"===e.code&&t.agent.addRequestNoreuse){t.agent={addRequest:t.agent.addRequestNoreuse.bind(t.agent)};t.start();t.req.end()}else{if(t.timeout&&t.timeoutTimer){clearTimeout(t.timeoutTimer);t.timeoutTimer=null}t.emit("error",e)}}};e.form&&t.form(e.form);e.oauth&&t.oauth(e.oauth);t.uri.auth&&!t.headers.authorization&&(t.headers.authorization="Basic "+toBase64(t.uri.auth.split(":").map((function(e){return se.unescape(e)})).join(":")));t.proxy&&t.proxy.auth&&!t.headers["proxy-authorization"]&&!t.tunnel&&(t.headers["proxy-authorization"]="Basic "+toBase64(t.proxy.auth.split(":").map((function(e){return se.unescape(e)})).join(":")));e.qs&&t.qs(e.qs);t.uri.path?t.path=t.uri.path:t.path=t.uri.pathname+(t.uri.search||"");0===t.path.length&&(t.path="/");t.proxy&&!t.tunnel&&(t.path=t.uri.protocol+"//"+t.uri.host+t.path);e.json?t.json(e.json):e.multipart&&t.multipart(e.multipart);if(t.body){var i=0;if(Z.isBuffer(t.body))i=t.body.length;else if(Array.isArray(t.body))for(var n=0;n<t.body.length;n++)i+=t.body[n].length;else{t.body=new Z(t.body);i=t.body.length}if(!i)throw new Error("Argument error, options.body.");t.headers["content-length"]=i}var s=t.proxy&&!t.tunnel?t.proxy.protocol:t.uri.protocol,a={"http:":ee,"https:":te},p=t.httpModules||{};t.httpModule=p[s]||a[s];if(!t.httpModule)throw new Error("Invalid protocol");e.ca&&(t.ca=e.ca);if(!t.agent){e.agentOptions&&(t.agentOptions=e.agentOptions);e.agentClass?t.agentClass=e.agentClass:e.forever?t.agentClass="http:"===s?ue:ue.SSL:t.agentClass=t.httpModule.Agent}if(false===t.pool)t.agent=false;else{t.agent=t.agent||t.getAgent();t.maxSockets&&(t.agent.maxSockets=t.maxSockets);t.pool.maxSockets&&(t.agent.maxSockets=t.pool.maxSockets)}t.once("pipe",(function(e){if(t.ntick)throw new Error("You cannot pipe to this stream after the first nextTick() after creation of the request stream.");t.src=e;if(isReadStream(e))t.headers["content-type"]||t.headers["Content-Type"]||(t.headers["content-type"]=ae.lookup(e.path.slice(e.path.lastIndexOf(".")+1)));else{if(e.headers)for(var o in e.headers)t.headers[o]||(t.headers[o]=e.headers[o]);e.method&&!t.method&&(t.method=e.method)}t.on("pipe",(function(){console.error("You have already piped to this stream. Pipeing twice is likely to break the request.")}))}));$.nextTick((function(){if(!t._aborted){if(t.body){Array.isArray(t.body)?t.body.forEach((function(e){t.write(e)})):t.write(t.body);t.end()}else if(t.requestBodyStream){console.warn("options.requestBodyStream is deprecated, please pass the request object to stream.pipe.");t.requestBodyStream.pipe(t)}else if(!t.src){t.headers["content-length"]=0;t.end()}t.ntick=true}}))};Request.prototype.getAgent=function(){var e=(this||W).agentClass;var t={};if((this||W).agentOptions)for(var o in(this||W).agentOptions)t[o]=(this||W).agentOptions[o];(this||W).ca&&(t.ca=(this||W).ca);var r="";e!==(this||W).httpModule.Agent&&(r+=e.name);if(!(this||W).httpModule.globalAgent){t.host=(this||W).host;t.port=(this||W).port;r&&(r+=":");r+=(this||W).host+":"+(this||W).port}if(t.ca){r&&(r+=":");r+=t.ca}return!r&&e===(this||W).httpModule.Agent&&(this||W).httpModule.globalAgent?(this||W).httpModule.globalAgent:(this||W).pool[r]?(this||W).pool[r]:(this||W).pool[r]=new e(t)};Request.prototype.start=function(){var e=this||W;if(!e._aborted){e._started=true;e.method=e.method||"GET";e.href=e.uri.href;me&&me("%method %href",e);e.req=e.httpModule.request(e,(function(t){if(!e._aborted){e._paused&&t.pause();e.response=t;t.request=e;t.toJSON=toJSON;if(e.httpModule!==te||!e.strictSSL||t.client.authorized){e.setHost&&delete e.headers.host;if(e.timeout&&e.timeoutTimer){clearTimeout(e.timeoutTimer);e.timeoutTimer=null}t.headers["set-cookie"]&&!e._disableCookies&&t.headers["set-cookie"].forEach((function(t){e._jar?e._jar.add(new le(t)):de.add(new le(t))}));if(t.statusCode>=300&&t.statusCode<400&&(e.followAllRedirects||e.followRedirect&&"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method)&&t.headers.location){if(e._redirectsFollowed>=e.maxRedirects){e.emit("error",new Error("Exceeded maxRedirects. Probably stuck in a redirect loop."));return}e._redirectsFollowed+=1;ge.test(t.headers.location)||(t.headers.location=re.resolve(e.uri.href,t.headers.location));e.uri=t.headers.location;e.redirects.push({statusCode:t.statusCode,redirectUri:t.headers.location});e.followAllRedirects&&(e.method="GET");delete e.req;delete e.agent;delete e._started;delete e.body;e.headers&&delete e.headers.host;me&&me("Redirect to %uri",e);e.init()}else{e._redirectsFollowed=e._redirectsFollowed||0;t.on("close",(function(){e._ended||e.response.emit("end")}));e.encoding&&(0!==e.dests.length?console.error("Ingoring encoding parameter as this stream is being piped to another stream which makes the encoding option invalid."):t.setEncoding(e.encoding));e.dests.forEach((function(t){e.pipeDest(t)}));t.on("data",(function(t){e._destdata=true;e.emit("data",t)}));t.on("end",(function(t){e._ended=true;e.emit("end",t)}));t.on("close",(function(){e.emit("close")}));e.emit("response",t);if(e.callback){var o=[];var r=0;e.on("data",(function(e){o.push(e);r+=e.length}));e.on("end",(function(){if(!e._aborted){if(o.length&&Z.isBuffer(o[0])){var i=new Z(r);var n=0;o.forEach((function(e){e.copy(i,n,0,e.length);n+=e.length}));null===e.encoding?t.body=i:t.body=i.toString()}else o.length&&(t.body=o.join(""));if(e._json)try{t.body=JSON.parse(t.body)}catch(e){}e.emit("complete",t,t.body)}}))}}}else{var i=t.client.authorizationError;e.emit("error",new Error("SSL Error: "+i))}}}));if(e.timeout&&!e.timeoutTimer){e.timeoutTimer=setTimeout((function(){e.req.abort();var t=new Error("ETIMEDOUT");t.code="ETIMEDOUT";e.emit("error",t)}),e.timeout);e.req.setTimeout&&e.req.setTimeout(e.timeout,(function(){if(e.req){e.req.abort();var t=new Error("ESOCKETTIMEDOUT");t.code="ESOCKETTIMEDOUT";e.emit("error",t)}}))}e.req.on("error",e.clientErrorHandler);e.emit("request",e.req)}};Request.prototype.abort=function(){(this||W)._aborted=true;(this||W).req?(this||W).req.abort():(this||W).response&&(this||W).response.abort();this.emit("abort")};Request.prototype.pipeDest=function(e){var t=(this||W).response;if(e.headers){e.headers["content-type"]=t.headers["content-type"];t.headers["content-length"]&&(e.headers["content-length"]=t.headers["content-length"])}if(e.setHeader){for(var o in t.headers)e.setHeader(o,t.headers[o]);e.statusCode=t.statusCode}(this||W).pipefilter&&this.pipefilter(t,e)};Request.prototype.setHeader=function(e,t,o){void 0===o&&(o=true);o||!(this||W).headers.hasOwnProperty(e)?(this||W).headers[e]=t:(this||W).headers[e]+=","+t;return this||W};Request.prototype.setHeaders=function(e){for(i in e)this.setHeader(i,e[i]);return this||W};Request.prototype.qs=function(e,t){var o;o=!t&&(this||W).uri.query?se.parse((this||W).uri.query):{};for(var r in e)o[r]=e[r];(this||W).uri=re.parse((this||W).uri.href.split("?")[0]+"?"+se.stringify(o));(this||W).url=(this||W).uri;return this||W};Request.prototype.form=function(e){(this||W).headers["content-type"]="application/x-www-form-urlencoded; charset=utf-8";(this||W).body=se.stringify(e).toString("utf8");return this||W};Request.prototype.multipart=function(e){var t=this||W;t.body=[];t.headers["content-type"]?t.headers["content-type"]=t.headers["content-type"].split(";")[0]+"; boundary=frontier":t.headers["content-type"]="multipart/related; boundary=frontier";if(!e.forEach)throw new Error("Argument error, options.multipart.");e.forEach((function(e){var o=e.body;if(!o)throw Error("Body attribute missing in multipart.");delete e.body;var r="--frontier\r\n";Object.keys(e).forEach((function(t){r+=t+": "+e[t]+"\r\n"}));r+="\r\n";t.body.push(new Z(r));t.body.push(new Z(o));t.body.push(new Z("\r\n"))}));t.body.push(new Z("--frontier--"));return t};Request.prototype.json=function(e){this.setHeader("content-type","application/json");this.setHeader("accept","application/json");(this||W)._json=true;"boolean"===typeof e?"object"===typeof(this||W).body&&((this||W).body=JSON.stringify((this||W).body)):(this||W).body=JSON.stringify(e);return this||W};Request.prototype.oauth=function(e){var t;(this||W).headers["content-type"]&&"application/x-www-form-urlencoded"===(this||W).headers["content-type"].slice(0,"application/x-www-form-urlencoded".length)&&(t=se.parse((this||W).body));(this||W).uri.query&&(t=se.parse((this||W).uri.query));t||(t={});var o={};for(var r in t)o[r]=t[r];for(var r in e)o["oauth_"+r]=e[r];o.oauth_version||(o.oauth_version="1.0");o.oauth_timestamp||(o.oauth_timestamp=Math.floor((new Date).getTime()/1e3).toString());o.oauth_nonce||(o.oauth_nonce=ce().replace(/-/g,""));o.oauth_signature_method="HMAC-SHA1";var i=o.oauth_consumer_secret;delete o.oauth_consumer_secret;var n=o.oauth_token_secret;delete o.oauth_token_secret;var s=(this||W).uri.protocol+"//"+(this||W).uri.host+(this||W).uri.pathname;var a=pe.hmacsign((this||W).method,s,o,i,n);for(var r in t)r.slice(0,"oauth_")in e||delete o["oauth_"+r];(this||W).headers.Authorization="OAuth "+Object.keys(o).sort().map((function(e){return e+'="'+pe.rfc3986(o[e])+'"'})).join(",");(this||W).headers.Authorization+=',oauth_signature="'+pe.rfc3986(a)+'"';return this||W};Request.prototype.jar=function(e){var t;0===(this||W)._redirectsFollowed&&((this||W).originalCookieHeader=(this||W).headers.cookie);if(false===e){t=false;(this||W)._disableCookies=true}else t=e?e.get({url:(this||W).uri.href}):de.get({url:(this||W).uri.href});if(t&&t.length){var o=t.map((function(e){return e.name+"="+e.value})).join("; ");(this||W).originalCookieHeader?(this||W).headers.cookie=(this||W).originalCookieHeader+"; "+o:(this||W).headers.cookie=o}(this||W)._jar=e;return this||W};Request.prototype.pipe=function(e,t){if((this||W).response){if((this||W)._destdata)throw new Error("You cannot pipe after data has been emitted from the response.");if((this||W)._ended)throw new Error("You cannot pipe after the response has been ended.");ne.Stream.prototype.pipe.call(this||W,e,t);this.pipeDest(e);return e}(this||W).dests.push(e);ne.Stream.prototype.pipe.call(this||W,e,t);return e};Request.prototype.write=function(){(this||W)._started||this.start();(this||W).req.write.apply((this||W).req,arguments)};Request.prototype.end=function(e){e&&this.write(e);(this||W)._started||this.start();(this||W).req.end()};Request.prototype.pause=function(){(this||W).response?(this||W).response.pause.apply((this||W).response,arguments):(this||W)._paused=true};Request.prototype.resume=function(){(this||W).response?(this||W).response.resume.apply((this||W).response,arguments):(this||W)._paused=false};Request.prototype.destroy=function(){(this||W)._ended||this.end()};function initParams(e,t,o){"function"!==typeof t||o||(o=t);if("object"===typeof t)t.uri=e;else if("string"===typeof e)t={uri:e};else{t=e;e=t.uri}return{uri:e,options:t,callback:o}}function request(e,t,o){if("undefined"===typeof e)throw new Error("undefined is not a valid uri or options object.");"function"!==typeof t||o||(o=t);"object"===typeof t?t.uri=e:t="string"===typeof e?{uri:e}:e;o&&(t.callback=o);var r=new Request(t);return r}X=request;request.defaults=function(e){var def=function(t){var d=function(o,r,i){var n=initParams(o,r,i);for(var s in e)void 0===n.options[s]&&(n.options[s]=e[s]);return t(n.options,n.callback)};return d};var t=def(request);t.get=def(request.get);t.post=def(request.post);t.put=def(request.put);t.head=def(request.head);t.del=def(request.del);t.cookie=def(request.cookie);t.jar=def(request.jar);return t};request.forever=function(e,t){var o={};if(t)for(option in t)o[option]=t[option];e&&(o.agentOptions=e);o.forever=true;return request.defaults(o)};request.get=request;request.post=function(e,t,o){var r=initParams(e,t,o);r.options.method="POST";return request(r.uri||null,r.options,r.callback)};request.put=function(e,t,o){var r=initParams(e,t,o);r.options.method="PUT";return request(r.uri||null,r.options,r.callback)};request.head=function(e,t,o){var r=initParams(e,t,o);r.options.method="HEAD";if(r.options.body||r.options.requestBodyStream||r.options.json&&"boolean"!==typeof r.options.json||r.options.multipart)throw new Error("HTTP HEAD requests MUST NOT include a request body.");return request(r.uri||null,r.options,r.callback)};request.del=function(e,t,o){var r=initParams(e,t,o);r.options.method="DELETE";return request(r.uri||null,r.options,r.callback)};request.jar=function(){return new he};request.cookie=function(e){e&&e.uri&&(e=e.uri);if("string"!==typeof e)throw new Error("The cookie function only accepts STRING as param");return new le(e)};function getSafe(e,t){if("object"===typeof e||"function"===typeof e)var o={};if(Array.isArray(e))var o=[];var r=[];Object.defineProperty(e,t,{});var i=Object.keys(e).filter((function(o){return o!==t&&("object"!==typeof e[o]&&"function"!==typeof e[o]||null===e[o]||!Object.getOwnPropertyDescriptor(e[o],t))}));for(var n=0;n<i.length;n++)if("object"!==typeof e[i[n]]&&"function"!==typeof e[i[n]]||null===e[i[n]])o[i[n]]=e[i[n]];else{r.push(i[n]);Object.defineProperty(e[i[n]],t,{})}for(var n=0;n<r.length;n++)o[r[n]]=getSafe(e[r[n]],t);return o}function toJSON(){return getSafe(this||W,(65536*(1+Math.random())|0).toString(16))}Request.prototype.toJSON=toJSON;var ye=X;export default ye;

